<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Pix - Modo Mínimo Compatível</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill="%23ffffff" fill-opacity="0.1"><circle cx="30" cy="30" r="1"/></g></svg>') repeat;
      pointer-events: none;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      position: relative;
      z-index: 1;
      animation: fadeInUp 0.8s ease-out;
      min-height: calc(100vh - 20px);
      display: flex;
      flex-direction: column;
    }

    h2 {
      color: #2d3748;
      text-align: center;
      margin-bottom: 25px;
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
      font-size: clamp(0.9rem, 3vw, 1rem);
    }

    input, select {
      width: 100%;
      padding: clamp(12px, 4vw, 18px);
      margin-top: 5px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: clamp(0.9rem, 3.5vw, 1.1rem);
      background: white;
      transition: all 0.3s ease;
      font-family: inherit;
      min-height: 50px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }

    button {
      width: 100%;
      padding: clamp(16px, 4vw, 20px);
      margin-top: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: clamp(1rem, 3.5vw, 1.2rem);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
      min-height: 55px;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.6);
    }

    button:active {
      transform: translateY(0);
    }

    #qrcode {
      margin-top: 20px;
      text-align: center;
      padding: 20px;
      background: #f8fafc;
      border-radius: 16px;
      border: 2px dashed #e2e8f0;
      min-height: clamp(200px, 50vw, 400px);
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
    }

    #qrcode img {
      max-width: 100%;
      max-height: 80vh;
      width: auto;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .pix-code {
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: clamp(15px, 4vw, 20px);
      font-family: 'Courier New', monospace;
      font-size: clamp(0.7rem, 2.5vw, 0.9rem);
      word-break: break-all;
      margin-top: 15px;
      color: #475569;
      line-height: 1.4;
      min-height: 60px;
      display: flex;
      align-items: center;
      max-height: 120px;
      overflow-y: auto;
    }

    .btn-group {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-group button {
      flex: 1;
      margin: 0;
      min-width: calc(50% - 5px);
      padding: clamp(14px, 4vw, 18px);
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      font-weight: 600;
    }

    .btn-group button:first-child {
      background: linear-gradient(135deg, #48bb78, #38a169);
      box-shadow: 0 4px 16px rgba(72, 187, 120, 0.4);
    }

    .btn-group button:last-child {
      background: linear-gradient(135deg, #ed8936, #dd6b20);
      box-shadow: 0 4px 16px rgba(237, 137, 54, 0.4);
    }

    .btn-group button:first-child:hover {
      box-shadow: 0 8px 24px rgba(72, 187, 120, 0.6);
    }

    .btn-group button:last-child:hover {
      box-shadow: 0 8px 24px rgba(237, 137, 54, 0.6);
    }

    .empty-state {
      color: #a0aec0;
      font-style: italic;
      text-align: center;
      font-size: clamp(0.9rem, 3vw, 1rem);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile específico */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      .container {
        padding: 15px;
        border-radius: 15px;
        min-height: calc(100vh - 10px);
      }

      #qrcode {
        min-height: clamp(250px, 60vw, 350px);
        padding: 15px;
      }

      .pix-code {
        font-size: clamp(0.6rem, 2.8vw, 0.8rem);
        padding: 12px;
        line-height: 1.3;
      }

      .btn-group {
        flex-direction: column;
        gap: 8px;
      }

      .btn-group button {
        min-width: 100%;
        flex: none;
      }

      input, select {
        font-size: 16px; /* Previne zoom no iOS */
      }
    }

    /* Landscape mobile */
    @media (max-width: 768px) and (orientation: landscape) {
      .container {
        min-height: calc(100vh - 10px);
      }

      #qrcode {
        min-height: 200px;
      }

      .btn-group {
        flex-direction: row;
      }

      .btn-group button {
        min-width: calc(50% - 5px);
      }
    }

    /* Tablets */
    @media (min-width: 769px) and (max-width: 1024px) {
      .container {
        max-width: 90%;
        padding: 30px;
      }

      #qrcode {
        min-height: 300px;
      }
    }

    /* Telas muito pequenas */
    @media (max-width: 320px) {
      .container {
        padding: 10px;
      }

      h2 {
        font-size: 1.3rem;
        margin-bottom: 15px;
      }

      label {
        margin-top: 10px;
        font-size: 0.85rem;
      }

      input, select {
        padding: 12px;
        font-size: 16px;
      }

      button {
        padding: 14px;
        font-size: 0.95rem;
      }

      #qrcode {
        min-height: 200px;
        padding: 10px;
      }

      .pix-code {
        font-size: 0.6rem;
        padding: 10px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Pix Compatível - Cópia e Cola + QR</h2>

  <label>Tipo da chave Pix:</label>
  <select id="tipo">
    <option value="">Selecione</option>
    <option value="cpf">CPF</option>
    <option value="cnpj">CNPJ</option>
    <option value="telefone">Telefone</option>
    <option value="email">E-mail</option>
    <option value="aleatoria">Chave Aleatória</option>
  </select>

  <label>Chave Pix:</label>
  <input id="chave" maxlength="77" placeholder="Digite sua chave Pix" />

  <label>Valor (opcional):</label>
  <input id="valor" type="number" step="0.01" placeholder="Ex: 49.90" />

  <button onclick="gerar()">Gerar QR Code e Cópia e Cola</button>

  <div id="qrcode">
    <div class="empty-state">QR Code aparecerá aqui</div>
  </div>
  
  <div class="pix-code" id="emv">
    <div class="empty-state">Código PIX aparecerá aqui</div>
  </div>
  
  <div class="btn-group">
    <button onclick="copiar()">📋 Copiar código Pix</button>
    <button onclick="baixar()">⬇️ Baixar QR Code</button>
  </div>
</div>

<script>
let imgBase64 = "";

function crc16(str) {
  let crc = 0xFFFF;
  for (let i = 0; i < str.length; i++) {
    crc ^= str.charCodeAt(i) << 8;
    for (let j = 0; j < 8; j++) {
      crc = (crc & 0x8000) ? ((crc << 1) ^ 0x1021) : (crc << 1);
      crc &= 0xFFFF;
    }
  }
  return crc.toString(16).toUpperCase().padStart(4, '0');
}

function gerar() {
  const tipo = document.getElementById("tipo").value;
  let chave = document.getElementById("chave").value.trim();
  const valor = document.getElementById("valor").value.trim();
  if (!tipo || !chave) return alert("Preencha tipo e chave Pix.");

  if (tipo === "telefone") {
    chave = chave.replace(/\D/g, "");
    if (!chave.startsWith("55")) chave = "55" + chave;
    chave = "+" + chave;
  } else if (tipo === "cpf" || tipo === "cnpj") {
    chave = chave.replace(/\D/g, "");
  }

  const gui = "BR.GOV.BCB.PIX";
  const merchantAccount = "00" + "14" + gui + "01" + chave.length.toString().padStart(2, '0') + chave;
  const merchantField = "26" + merchantAccount.length.toString().padStart(2, '0') + merchantAccount;

  let payload = "000201" + merchantField +
                "52040000" +
                "5303986" +
                "5802BR" +
                "5901N" +
                "6001C";

  if (valor && !isNaN(parseFloat(valor))) {
    const valorFmt = parseFloat(valor).toFixed(2);
    payload += "54" + valorFmt.length.toString().padStart(2, '0') + valorFmt;
  }

  payload += "62070503***" + "6304";
  const crc = crc16(payload);
  payload += crc;

  document.getElementById("emv").textContent = payload;

  // QR Code com tamanho otimizado para mobile
  const isMobile = window.innerWidth <= 768;
  const scale = isMobile ? 12 : 8;
  
  QRCode.toDataURL(payload, {
    errorCorrectionLevel: 'M',
    margin: 4,
    scale: scale,
    width: isMobile ? 300 : 256
  }, function (err, url) {
    if (err) return alert("Erro ao gerar QR Code.");
    imgBase64 = url;
    const img = new Image();
    img.src = url;
    img.alt = "QR Code Pix";
    img.style.maxWidth = "100%";
    img.style.height = "auto";
    const qrDiv = document.getElementById('qrcode');
    qrDiv.innerHTML = "";
    qrDiv.appendChild(img);
  });
}

function copiar() {
  const codigo = document.getElementById("emv").textContent;
  if (codigo.includes("aparecerá aqui")) {
    return alert("Gere um código PIX primeiro!");
  }
  
  if (navigator.clipboard) {
    navigator.clipboard.writeText(codigo).then(() => {
      alert("Código Pix copiado com sucesso!");
    }).catch(() => {
      // Fallback para dispositivos mais antigos
      fallbackCopy(codigo);
    });
  } else {
    fallbackCopy(codigo);
  }
}

function fallbackCopy(text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.position = "fixed";
  textArea.style.left = "-999999px";
  textArea.style.top = "-999999px";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    alert("Código Pix copiado com sucesso!");
  } catch (err) {
    alert("Erro ao copiar. Copie manualmente o código.");
  }
  
  document.body.removeChild(textArea);
}

function baixar() {
  if (!imgBase64) return alert("Gere um QR Code antes de baixar.");
  const a = document.createElement('a');
  a.href = imgBase64;
  a.download = "qrcode_pix.png";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

// Otimização para telas pequenas
window.addEventListener('resize', function() {
  // Regenera QR code com tamanho otimizado quando a orientação muda
  const emvElement = document.getElementById("emv");
  if (emvElement && !emvElement.textContent.includes("aparecerá aqui")) {
    // Há um código gerado, regenera com novo tamanho
    const isMobile = window.innerWidth <= 768;
    const scale = isMobile ? 12 : 8;
    
    QRCode.toDataURL(emvElement.textContent, {
      errorCorrectionLevel: 'M',
      margin: 4,
      scale: scale,
      width: isMobile ? 300 : 256
    }, function (err, url) {
      if (!err) {
        imgBase64 = url;
        const img = new Image();
        img.src = url;
        img.alt = "QR Code Pix";
        img.style.maxWidth = "100%";
        img.style.height = "auto";
        const qrDiv = document.getElementById('qrcode');
        qrDiv.innerHTML = "";
        qrDiv.appendChild(img);
      }
    });
  }
});
</script>

</body>
</html>
